# Система классификации и предобработки токенов

Этот модуль предоставляет структурированную систему для классификации и предобработки токенов товарных наименований перед поиском аналогов.

## Обзор

Система основана на анализе структуры товарных наименований, где:
- **Первое слово** - это название товара (например, "светильник", "автомат", "строп")
- **Последующие слова** - это технические параметры, бренды, артикулы и характеристики

## Основные компоненты

### 1. TokenClassifier

Классификатор токенов, который разделяет все токены на категории:

- **pass_names** - названия товаров (первое слово)
- **stop_words** - служебные слова ("на", "от", "для", "по", "до", "и", "с", "в", "из", "под", "к")
- **names_model** - названия брендов/моделей ("bosch", "huawei", "siemens")
- **articles** - артикулы и коды ("дпо-108", "w80dm", "Dect-T393-4XAA")
- **parameters** - технические параметры по категориям:
  - TYPE: тип, led, светодиодная, дифференциальный
  - CATEGORY: потолочный, оцинкованный, зимний
  - CHARACTERISTIC: c, d, dk, ту, up, пвх
  - DIAMETER: диаметр, ду, d-36мм
  - BREAKING_CAPACITY: 6ка, 6ka, 4,5ка, 10ка
  - CURRENT: 32a, 63a, 20a, 16а
  - VOLTAGE: 24v, 220в, 380в
  - POLES: 1p, 2p, 3p, 3n+p, 4p
  - POWER: 30вт, 24-70w, 50w, квт
  - COUNT: шт, уп.10, 2-4(пар)
  - TEMPERATURE: 6500k, градусов
  - WEIGHT: 500мл, 400г, 24кг, кг, тонн
  - LENGTH: 1200мм, 4м, 30мм, мм, м
  - COLOR: белый, красный, черный, синий
  - MATERIAL: сталь, пластик, резина, алюминий
  - IP: ip40, ip54, ip65
  - THREAD: м22, м16*1,5
  - COUNTRY: россия
  - SPEED: мбит/с
  - FREQUENCY: (пустая категория)
  - CASH: числовые значения и коды
  - WAIT: ожидание, отстой, сутки
  - PRESSURE: ру16

### 2. ProductNamePreprocessor

Предпроцессор названий товаров, который:

- Очищает текст от лишних символов
- Нормализует названия с помощью классификатора
- Извлекает числовые значения с единицами измерения
- Создает структурированные данные для поиска
- Формирует поисковые запросы
- Поддерживает пакетную обработку

## Использование

### Базовое использование

```python
from same_clear.text_processing import create_token_classifier, create_product_preprocessor

# Создаем классификатор
classifier = create_token_classifier()

# Создаем предпроцессор
preprocessor = create_product_preprocessor(classifier)

# Предобрабатываем название товара
product_name = "Светильник LED потолочный белый 32A 220В"
result = preprocessor.preprocess_product_name(product_name)

print(f"Тип товара: {result['product_type']}")
print(f"Технические характеристики: {result['technical_specs']}")
print(f"Бренды: {result['brand_info']}")
print(f"Параметры для поиска: {result['searchable_parameters']}")
```

### Работа с конфигурацией

```python
# Загрузка пользовательской конфигурации
classifier = create_token_classifier('custom_tokens.json')

# Добавление новых токенов
classifier.pass_names.add('новый_товар')
classifier.names_model.add('новый_бренд')
classifier.parameters['TYPE'].add('новый_тип')

# Сохранение конфигурации
classifier.save_config('updated_tokens.json')
```

### Пакетная обработка

```python
# Список названий товаров
product_names = [
    "Светильник LED потолочный белый 32A 220В",
    "Автомат дифференциальный Bosch 63A 30mA",
    "Строп цепной одноветвевой 6мм 2м"
]

# Пакетная обработка
results = preprocessor.batch_preprocess(product_names)

# Статистика обработки
stats = preprocessor.get_preprocessing_statistics(results)
print(f"Успешно обработано: {stats['successful']}/{stats['total_processed']}")
```

### Создание поисковых запросов

```python
# Создание поискового запроса
search_query = preprocessor.create_search_query(
    result,
    include_brands=True,
    include_articles=False
)
print(f"Поисковый запрос: {search_query}")
```

### Экспорт данных

```python
# Экспорт в различных форматах
json_output = preprocessor.export_preprocessed_data(results, 'json')
csv_output = preprocessor.export_preprocessed_data(results, 'csv')
text_output = preprocessor.export_preprocessed_data(results, 'text')
```

## Демонстрация

Запустите демонстрационный скрипт для ознакомления с возможностями:

```bash
cd examples
python token_processing_demo.py
```

## Структура данных

### Входные данные
- Название товара (строка)

### Выходные данные
```python
{
    'original_name': 'Исходное название',
    'cleaned_name': 'Очищенное название',
    'normalized': {
        'product_name': ['тип_товара'],
        'parameters': ['параметр1', 'параметр2'],
        'brands': ['бренд1', 'бренд2'],
        'articles': ['артикул1'],
        'stop_words': ['служебное_слово'],
        'unknown': ['неизвестный_токен']
    },
    'numeric_values': [('32', 'a'), ('220', 'в')],
    'searchable_parameters': ['led', 'потолочный', 'белый', '32a', '220в'],
    'product_type': 'светильник',
    'technical_specs': {
        'TYPE': ['led'],
        'CATEGORY': ['потолочный'],
        'COLOR': ['белый'],
        'CURRENT': ['32a'],
        'VOLTAGE': ['220в']
    },
    'brand_info': [],
    'article_info': []
}
```

## Преимущества системы

1. **Структурированность** - четкое разделение токенов по категориям
2. **Гибкость** - возможность настройки и расширения категорий
3. **Производительность** - быстрая классификация с использованием множеств
4. **Масштабируемость** - поддержка пакетной обработки
5. **Интеграция** - легко интегрируется в существующие системы поиска
6. **Конфигурируемость** - загрузка/сохранение настроек в JSON

## Применение в поиске аналогов

1. **Предобработка запроса** - нормализация входящего названия товара
2. **Извлечение ключевых параметров** - выделение технических характеристик
3. **Фильтрация шума** - удаление служебных слов и незначимых токенов
4. **Структурирование поиска** - создание оптимизированных поисковых запросов
5. **Анализ результатов** - статистика по обработанным данным

## Расширение системы

Для добавления новых категорий токенов:

1. Добавьте новую категорию в `parameters` словарь
2. Обновите логику классификации в `classify_token`
3. Добавьте обработку в `normalize_product_name`
4. Обновите статистику в `get_token_statistics`

## Требования

- Python 3.7+
- Стандартная библиотека Python (json, re, csv, io)
- Поддержка типизации (typing)

## Лицензия

Внутренний модуль проекта SAMe.

